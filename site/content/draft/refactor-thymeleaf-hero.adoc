= Optimiser ses Templates JBake avec les Fragments Thymeleaf : Le Cas Pratique de la "Hero Section"
CherOlivier <cheroliv@cheroliv.com>
:jbake-status: published
:jbake-type: post
:jbake-tags: jbake, thymeleaf, refactoring, frontend, webdev, modularite
:jbake-date: 2025-08-29
:jbake-summary: Un guide pratique pour refactoriser une section de page en un fragment Thymeleaf réutilisable dans un projet JBake, améliorant ainsi la maintenabilité et la clarté du code.

Dans le développement de sites web, même statiques, la complexité des pages peut rapidement augmenter. Un fichier de template unique pour une page d'accueil bien remplie devient vite difficile à maintenir. C'est là que la modularité entre en jeu.

Aujourd'hui, nous allons voir comment extraire une section "Hero" d'un template principal `index.thyme` pour en faire un fragment Thymeleaf réutilisable dans un projet JBake. Cette approche, basée sur le principe DRY (Don't Repeat Yourself), améliore non seulement la lisibilité mais aussi la maintenabilité de notre base de code.

== Le Point de Départ : Un Template Monolithique

Initialement, notre page d'accueil `index.thyme` contenait tout le balisage HTML, y compris une section "Hero" assez conséquente.

.site/templates/index.thyme (avant refactoring)
[source,html]
----
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <!-- ... en-têtes ... -->
</head>
<body>
    <div th:replace="menu.thyme::menu"></div>

    <!-- Hero Section -->
    <section id="home" class="hero-section">
        <div class="container">
            <!-- ... tout le contenu de la section hero ... -->
        </div>
    </section>

    <!-- About Section -->
    <section id="about" class="py-5">
        <!-- ... -->
    </section>

    <!-- ... reste de la page ... -->
</body>
</html>
----

Bien que fonctionnelle, cette structure rend le fichier `index.thyme` verbeux et mélange des responsabilités qui pourraient être séparées.

== Pourquoi Refactoriser ? La Puissance des Fragments

L'objectif est de découpler les composants de notre page. En isolant la section "Hero", nous gagnons plusieurs avantages :

*   **Maintenabilité :** Modifier la section "Hero" ne nécessite plus de naviguer dans un fichier immense.
*   **Réutilisabilité :** Le même fragment "Hero" pourrait, si besoin, être réutilisé sur d'autres pages avec des variations mineures.
*   **Clarté :** Le template `index.thyme` devient un squelette qui assemble des blocs, rendant sa structure bien plus évidente.

Voici une illustration de la transition d'une structure monolithique à une structure modulaire.

[plantuml, a-monolithic-vs-modular, svg]
----
@startuml
skinparam componentStyle uml2

package "Structure Monolithique" {
  [index.thyme] as IndexMono
  [Hero Section] as HeroMono
  [About Section] as AboutMono

  IndexMono -down- HeroMono
  IndexMono -down- AboutMono
  HeroMono -[hidden]- AboutMono
}

package "Structure Modulaire" {
  [index.thyme] as IndexMod
  [hero_section.thyme] as HeroMod
  [about_section.thyme] as AboutMod

  IndexMod ..> HeroMod : inclut
  IndexMod ..> AboutMod : inclut
}

@enduml
----

== La Mise en Œuvre : Étape par Étape

Le processus est simple et se déroule en deux temps.

. **Étape 1 : Créer le fichier de fragment**
+
Nous créons un nouveau fichier `site/templates/hero_section.thyme`. Son contenu est la section HTML que nous avons coupée de `index.thyme`, à laquelle nous ajoutons un attribut `th:fragment`.

.site/templates/hero_section.thyme
[source,html]
----
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<body>
    <section id="home" class="hero-section" th:fragment="hero"> <1>
        <div id="main-content"></div>
        <div class="container">
            <!-- ... contenu complet de la section hero ... -->
        </div>
    </section>
</body>
</html>
----
<1> `th:fragment="hero"` est la clé. Il déclare que ce bloc `<section>` est un fragment réutilisable nommé "hero".

. **Étape 2 : Remplacer le code dans le template principal**
+
Maintenant, dans `index.thyme`, nous supprimons l'intégralité de la section "Hero" et la remplaçons par une seule ligne qui appelle notre nouveau fragment.

.site/templates/index.thyme (après refactoring)
[source,html]
----
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <!-- ... en-têtes ... -->
</head>
<body>
    <div th:replace="menu.thyme::menu"></div>

    <div th:replace="hero_section.thyme::hero"></div> <1>

    <!-- About Section -->
    <section id="about" class="py-5">
        <!-- ... -->
    </section>

    <!-- ... reste de la page ... -->
</body>
</html>
----
<1> `th:replace="hero_section.thyme::hero"` indique à Thymeleaf de remplacer cette balise `<div>` par le fragment nommé "hero" trouvé dans le fichier `hero_section.thyme`.

=== `th:replace` ou `th:include` ?

Thymeleaf propose deux options principales pour inclure des fragments :
- `th:replace` : Remplace la balise hôte (le `<div>` dans notre cas) par le fragment. Le résultat final ne contiendra pas le `<div>`.
- `th:include` : Insère le fragment *à l'intérieur* de la balise hôte. Le `<div>` serait conservé.

Pour notre cas, `th:replace` est plus propre car notre fragment est déjà une balise `<section>` autonome.

== Visualisation du Processus de Rendu

Le diagramme de séquence suivant illustre comment le moteur de template JBake (utilisant Thymeleaf) assemble la page finale.

[plantuml, b-rendering-sequence, svg]
----
@startuml
participant "JBake" as JB
participant "Moteur Thymeleaf" as TE
participant "index.thyme" as IT
participant "hero_section.thyme" as HT

activate JB
JB -> TE : Demande de rendu de "index.thyme"
activate TE

TE -> IT : Lecture du contenu
activate IT
IT --> TE : Contenu avec <div th:replace="...">
deactivate IT

TE -> TE : Analyse du contenu
TE -> HT : Recherche du fragment "hero"
activate HT
HT --> TE : Contenu du fragment <section>
deactivate HT

TE -> TE : Remplace le <div> par la <section>
TE --> JB : HTML final assemblé
deactivate TE

deactivate JB
@enduml
----

== Conclusion

En extrayant la section "Hero" dans son propre fragment, nous avons rendu notre projet plus modulaire, plus propre et plus facile à maintenir. C'est une pratique essentielle qui, appliquée à d'autres composants comme le pied de page, le menu ou des cartes réutilisables, transforme une simple page en un système de templates robuste et évolutif.
