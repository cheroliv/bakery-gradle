= Alignement Parfait : Gérer le Décalage des Sections avec une Barre de Navigation Fixe
:author: cheroliv
:email: cheroliv@example.com
:date: 2025-09-02
:toc: left
:toclevels: 3
:jbake-type: post
:jbake-status: published
:jbake-tags: JavaScript, UX, Navigation, Web Development, Accessibility


== Introduction

Dans le développement web moderne, les barres de navigation fixes sont omniprésentes. Elles offrent une expérience utilisateur cohérente en restant visibles lors du défilement. Cependant, cette commodité introduit un défi : lorsque l'utilisateur clique sur un lien d'ancrage (`#section`) pour naviguer vers une partie spécifique de la page, la section cible peut se retrouver partiellement masquée sous la barre de navigation fixe. Ce décalage, bien que subtil, peut nuire à l'expérience utilisateur en cachant le début du contenu pertinent.

Cet article explore la problématique de ce décalage et présente une solution élégante basée sur JavaScript pour garantir un alignement parfait des sections, améliorant ainsi la fluidité et la précision de la navigation.

== La Problématique du Décalage

Imaginez une page web avec une barre de navigation en haut qui reste fixe lorsque vous faites défiler. Chaque élément du menu de navigation pointe vers une section spécifique de la page.

[source, html]
----
<nav class="navbar fixed-top">
    <!-- ... liens de navigation ... -->
</nav>

<section id="about">
    <h2>À propos de moi</h2>
    <!-- ... contenu ... -->
</section>

<section id="services">
    <h2>Mes services</h2>
    <!-- ... contenu ... -->
</section>
----

Lorsque l'utilisateur clique sur un lien comme "À propos", le navigateur tente de faire défiler la page pour que le haut de la section `#about` soit aligné avec le haut de la fenêtre. Cependant, comme la `navbar` est `fixed-top`, elle chevauche le début de la section, comme illustré ci-dessous :



Ce comportement par défaut est indésirable car il force l'utilisateur à faire défiler manuellement un peu plus pour voir le titre et le début de la section.

== Cas d'Utilisation : Navigation avec Offset

Pour résoudre ce problème, nous voulons que le système ajuste automatiquement la position de défilement pour que le haut de la section cible soit *juste en dessous* de la barre de navigation fixe.

[plantuml, smooth_scroll_offset_use_case, png]
----
@startuml
left to right direction
actor "Utilisateur" as user

rectangle "Système de Navigation" {
  usecase "Cliquer sur un Lien de Navigation" as click_link
  usecase "Calculer l'Offset de la Barre de Navigation" as calculate_offset
  usecase "Défiler vers la Section Cible avec Offset" as scroll_with_offset
}

user --> click_link
click_link --> calculate_offset
calculate_offset --> scroll_with_offset
@enduml
----

== Conception de la Solution

Nous allons implémenter une classe JavaScript, `SmoothScrollWithOffset`, qui interceptera les clics sur les liens d'ancrage internes. Cette classe sera responsable de :
1.  Déterminer la hauteur de la barre de navigation fixe.
2.  Calculer la position de défilement ajustée.
3.  Effectuer un défilement doux vers cette nouvelle position.

=== Diagramme de Composants

Le composant `SmoothScrollWithOffset` interagit principalement avec le DOM pour lire la hauteur de la barre de navigation et manipuler la position de défilement de la fenêtre.

[plantuml, smooth_scroll_offset_component, png]
----
@startuml
component "Navigateur Web" as browser {
  [DOM (Document Object Model)] as dom
  [Window (API de Défilement)] as window_api
}

component "Application Web" as app {
  [Barre de Navigation (HTML)] as navbar_html
  [Sections Cibles (HTML)] as sections_html
  [SmoothScrollWithOffset (JS)] as smooth_scroll_js
}

navbar_html -- (dom) : Accès à la hauteur
sections_html -- (dom) : Accès à la position
smooth_scroll_js ..> dom : Lit hauteur/position
smooth_scroll_js ..> window_api : Défilement
smooth_scroll_js ..> navbar_html : Cible la navbar
smooth_scroll_js ..> sections_html : Cible les sections
@enduml
----

=== Diagramme d'Interaction

Voici la séquence des événements lorsqu'un utilisateur clique sur un lien de navigation :

[plantuml, smooth_scroll_offset_sequence, png]
----
@startuml
autonumber
actor "Utilisateur" as user
participant "Lien de Navigation" as link
participant "SmoothScrollWithOffset" as smooth_scroll
participant "DOM" as dom
participant "Window" as window

user -> link : Clic (href="#target")
activate link
link -> smooth_scroll : handleAnchorClick(event)
activate smooth_scroll
smooth_scroll -> dom : getElementById("target")
activate dom
dom --> smooth_scroll : targetElement
deactivate dom
smooth_scroll -> dom : querySelector(".navbar")
activate dom
dom --> smooth_scroll : navbarElement
deactivate dom
smooth_scroll -> navbarElement : offsetHeight
activate navbarElement
navbarElement --> smooth_scroll : navbarHeight
deactivate navbarElement
smooth_scroll -> targetElement : getBoundingClientRect().top
activate targetElement
targetElement --> smooth_scroll : targetTopPosition
deactivate targetElement
smooth_scroll -> window : scrollY
activate window
window --> smooth_scroll : currentScrollY
deactivate window
smooth_scroll -> smooth_scroll : Calcul offsetPosition = targetTopPosition + currentScrollY - navbarHeight
smooth_scroll -> window : scrollTo({top: offsetPosition, behavior: 'smooth'})
activate window
window --> smooth_scroll : Défilement terminé
deactivate window
deactivate smooth_scroll
deactivate link
@enduml
----

=== Diagramme de Flux

Le flux logique de la méthode `handleAnchorClick` est le suivant :

[plantuml, smooth_scroll_offset_flow, png]
----
@startuml
start
:Utilisateur clique sur un lien d'ancrage;
if (Lien est "#" ou "#home"?) then (oui)
  :Défiler vers le haut de la page (0);
else (non)
  :Extraire l'ID de la cible;
  :Trouver l'élément cible dans le DOM;
  if (Élément cible existe?) then (oui)
    :Obtenir la hauteur de la barre de navigation fixe;
    :Calculer la position de l'élément cible par rapport au document;
    :Calculer la position de défilement ajustée (position_cible - hauteur_navbar);
    :Défiler doucement vers la position ajustée;
  else (non)
    :Laisser le comportement par défaut du navigateur;
  endif
endif
stop
@enduml
----

== Implémentation JavaScript

La classe `SmoothScrollWithOffset` est ajoutée à `site/assets/js/script.js`.

[source, javascript]
----
class SmoothScrollWithOffset {
    constructor(navbarSelector = '.navbar') {
        this.navbar = document.querySelector(navbarSelector);
        this.init();
    }

    init() {
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', this.handleAnchorClick.bind(this));
        });
    }

    handleAnchorClick(event) {
        const href = event.currentTarget.getAttribute('href');
        if (href === '#' || href === '#home') { // Gérer #home ou un hash vide spécifiquement
            event.preventDefault();
            window.scrollTo({ top: 0, behavior: 'smooth' });
            return;
        }

        const targetId = href.substring(1);
        const targetElement = document.getElementById(targetId);

        if (targetElement) {
            event.preventDefault();
            const navbarHeight = this.navbar ? this.navbar.offsetHeight : 0;
            const elementPosition = targetElement.getBoundingClientRect().top + window.scrollY;
            const offsetPosition = elementPosition - navbarHeight;

            window.scrollTo({
                top: offsetPosition,
                behavior: 'smooth'
            });
        }
    }
}

// Initialisation dans le DOMContentLoaded
document.addEventListener('DOMContentLoaded', () => {
    // ... autres initialisations ...

    // Safely initialize SmoothScrollWithOffset
    try {
        new SmoothScrollWithOffset();
    } catch (e) {
        console.error("Failed to initialize SmoothScrollWithOffset:", e);
    }
});
----

Cette implémentation garantit que chaque fois qu'un utilisateur clique sur un lien d'ancrage, la page défile de manière fluide jusqu'à la section désirée, en la positionnant juste en dessous de la barre de navigation fixe.

== Conclusion

L'intégration de la classe `SmoothScrollWithOffset` résout efficacement le problème du chevauchement de contenu par les barres de navigation fixes. En ajustant précisément la position de défilement, nous améliorons significativement l'expérience utilisateur, rendant la navigation plus intuitive et agréable. Cette petite amélioration technique a un impact majeur sur la perception de la qualité et de la fluidité du site.
