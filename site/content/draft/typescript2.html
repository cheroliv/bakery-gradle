<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.23">
<meta name="author" content="@cheroliv">
<title>Tester votre code TypeScript dans JBake : Tests unitaires avec Vitest et tests E2E avec Playwright</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child{border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:first-child,.sidebarblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child,.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active,#footnotes .footnote a:first-of-type:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,td.hdlist1,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
/*! Asciidoctor Tabs | Copyright (c) 2018-present Dan Allen | MIT License */
.tabs {
    margin-bottom: 1.25em;
}

.tablist > ul {
    display: flex;
    flex-wrap: wrap;
    list-style: none;
    margin: 0;
    padding: 0;
}

.tablist > ul li {
    align-items: center;
    background-color: #fff;
    cursor: pointer;
    display: flex;
    font-weight: bold;
    line-height: 1.5;
    padding: 0.25em 1em;
    position: relative;
}

.tablist > ul li:focus-visible {
    outline: none;
}

.tablist.ulist,
.tablist.ulist > ul li {
    margin: 0;
}

.tablist.ulist > ul li + li {
    margin-left: 0.25em;
}

.tabs .tablist li::after {
    content: "";
    display: block;
    height: 1px;
    position: absolute;
    bottom: -1px;
    left: 0;
    right: 0;
}

.tabs.is-loading .tablist li:not(:first-child),
.tabs:not(.is-loading) .tablist li:not(.is-selected) {
    background-color: #f5f5f5;
}

.tabs.is-loading .tablist li:first-child::after,
.tabs:not(.is-loading) .tablist li.is-selected::after {
    background-color: #fff;
}

/*
.tabs:not(.is-loading) .tablist li,
.tabs:not(.is-loading) .tablist li::after {
  transition: background-color 200ms ease-in-out;
}
*/

.tablist > ul p {
    line-height: inherit;
    margin: 0;
}

.tabpanel {
    background-color: #fff;
    padding: 1.25em;
}

.tablist > ul li,
.tabpanel {
    border: 1px solid #dcdcdc;
}

.tablist > ul li {
    border-bottom: 0;
}

.tabs.is-loading .tabpanel + .tabpanel,
.tabs:not(.is-loading) .tabpanel.is-hidden {
    display: none;
}

.tabpanel > :first-child {
    margin-top: 0;
}

/* #content is a signature of the Asciidoctor standalone HTML output */
#content .tabpanel > :last-child,
#content .tabpanel > :last-child > :last-child,
#content .tabpanel > :last-child > :last-child > li:last-child > :last-child {
    margin-bottom: 0;
}

.tablecontainer {
    overflow-x: auto;
}

#content .tablecontainer {
    margin-bottom: 1.25em;
}

#content .tablecontainer > table.tableblock {
    margin-bottom: 0;
}
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Tester votre code TypeScript dans JBake : Tests unitaires avec Vitest et tests E2E avec Playwright</h1>
<div class="details">
<span id="author" class="author">@cheroliv</span><br>
<span id="revdate">2025-05-28</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Sommaire</div>
<ul class="sectlevel1">
<li><a href="#pourquoi_tester_dans_un_contexte_jbake">1. Pourquoi tester dans un contexte JBake ?</a></li>
<li><a href="#architecture_de_test">2. Architecture de test</a></li>
<li><a href="#structure_du_projet_mise_à_jour">3. Structure du projet mise à jour</a></li>
<li><a href="#configuration_des_tests_unitaires_avec_vitest">4. Configuration des tests unitaires avec Vitest</a>
<ul class="sectlevel2">
<li><a href="#installation_des_dépendances">4.1. Installation des dépendances</a></li>
<li><a href="#configuration_vitest">4.2. Configuration Vitest</a></li>
<li><a href="#fichier_de_setup_des_tests">4.3. Fichier de setup des tests</a></li>
</ul>
</li>
<li><a href="#tests_unitaires_exemples_pratiques">5. Tests unitaires : Exemples pratiques</a>
<ul class="sectlevel2">
<li><a href="#test_dune_classe_utilitaire">5.1. Test d&#8217;une classe utilitaire</a></li>
<li><a href="#test_dun_composant_avec_dom">5.2. Test d&#8217;un composant avec DOM</a></li>
</ul>
</li>
<li><a href="#configuration_des_tests_e2e_avec_playwright">6. Configuration des tests E2E avec Playwright</a>
<ul class="sectlevel2">
<li><a href="#installation_de_playwright">6.1. Installation de Playwright</a></li>
<li><a href="#configuration_playwright">6.2. Configuration Playwright</a></li>
<li><a href="#tests_e2e_navigation_et_recherche">6.3. Tests E2E : Navigation et recherche</a></li>
</ul>
</li>
<li><a href="#scripts_de_test_intégrés">7. Scripts de test intégrés</a></li>
<li><a href="#intégration_avec_le_build_gradle">8. Intégration avec le build Gradle</a></li>
<li><a href="#intégration_cicd">9. Intégration CI/CD</a>
<ul class="sectlevel2">
<li><a href="#github_actions">9.1. GitHub Actions</a></li>
</ul>
</li>
<li><a href="#bonnes_pratiques_de_test">10. Bonnes pratiques de test</a>
<ul class="sectlevel2">
<li><a href="#tests_unitaires">10.1. Tests unitaires</a></li>
<li><a href="#tests_dintégration">10.2. Tests d&#8217;intégration</a></li>
<li><a href="#tests_e2e">10.3. Tests E2E</a></li>
<li><a href="#organisation_des_tests">10.4. Organisation des tests</a></li>
</ul>
</li>
<li><a href="#configuration_des_tests_unitaires_avec_vitest_2">11. Configuration des tests unitaires avec Vitest</a>
<ul class="sectlevel2">
<li><a href="#installation_des_dépendances_2">11.1. Installation des dépendances</a></li>
<li><a href="#configuration_vitest_2">11.2. Configuration Vitest</a></li>
<li><a href="#fichier_de_setup_des_tests_2">11.3. Fichier de setup des tests</a></li>
</ul>
</li>
<li><a href="#tests_unitaires_exemples_pratiques_2">12. Tests unitaires : Exemples pratiques</a>
<ul class="sectlevel2">
<li><a href="#test_dune_classe_utilitaire_2">12.1. Test d&#8217;une classe utilitaire</a></li>
<li><a href="#test_dun_composant_avec_dom_2">12.2. Test d&#8217;un composant avec DOM</a></li>
</ul>
</li>
<li><a href="#configuration_des_tests_e2e_avec_playwright_2">13. Configuration des tests E2E avec Playwright</a>
<ul class="sectlevel2">
<li><a href="#installation_de_playwright_2">13.1. Installation de Playwright</a></li>
<li><a href="#configuration_playwright_2">13.2. Configuration Playwright</a></li>
<li><a href="#tests_e2e_navigation_et_recherche_2">13.3. Tests E2E : Navigation et recherche</a></li>
</ul>
</li>
<li><a href="#scripts_de_test_intégrés_2">14. Scripts de test intégrés</a></li>
<li><a href="#intégration_avec_le_build_gradle_2">15. Intégration avec le build Gradle</a></li>
<li><a href="#intégration_cicd_2">16. Intégration CI/CD</a>
<ul class="sectlevel2">
<li><a href="#github_actions_2">16.1. GitHub Actions</a></li>
</ul>
</li>
<li><a href="#bonnes_pratiques_de_test_2">17. Bonnes pratiques de test</a>
<ul class="sectlevel2">
<li><a href="#tests_unitaires_2">17.1. Tests unitaires</a></li>
<li><a href="#tests_dintégration_2">17.2. Tests d&#8217;intégration</a></li>
<li><a href="#tests_e2e_2">17.3. Tests E2E</a></li>
<li><a href="#organisation_des_tests_2">17.4. Organisation des tests</a></li>
</ul>
</li>
<li><a href="#conclusion">18. Conclusion</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Intégrer TypeScript dans JBake avec Vite</p>
</div>
<div class="paragraph">
<p>Dans la <a href="/blog/2025/integrer-typescript-jbake-vite.html">première partie</a> de cette série, nous avons vu comment intégrer TypeScript dans JBake avec Vite.
Maintenant, nous allons ajouter une stratégie de test complète avec des tests unitaires via Vitest et des tests end-to-end avec Playwright.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="pourquoi_tester_dans_un_contexte_jbake">1. Pourquoi tester dans un contexte JBake ?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Même pour un site statique, les tests apportent une valeur considérable :</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Tests unitaires</strong> - Validez la logique métier de vos composants TypeScript</p>
</li>
<li>
<p><strong>Tests d&#8217;intégration</strong> - Vérifiez les interactions entre composants</p>
</li>
<li>
<p><strong>Tests E2E</strong> - Assurez-vous que l&#8217;expérience utilisateur fonctionne correctement</p>
</li>
<li>
<p><strong>Régression</strong> - Détectez automatiquement les cassures lors des modifications</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="architecture_de_test">2. Architecture de test</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Notre stratégie de test suit la pyramide classique :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>        /\
       /  \     Tests E2E (Playwright)
      /____\    - Navigation
     /      \   - Workflows utilisateur
    /        \  - Tests cross-browser
   /__________\
  /            \ Tests d'intégration (Vitest + jsdom)
 /              \ - Interactions DOM
/________________\ - API calls mockées
|                |
|  Tests unitaires| Tests unitaires (Vitest)
|   (Vitest)     | - Logique métier
|________________| - Fonctions pures</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="structure_du_projet_mise_à_jour">3. Structure du projet mise à jour</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>mon-blog/
├── src/
│   ├── main/jbake/              # JBake standard
│   └── ts/                      # Sources TypeScript
│       ├── components/
│       ├── utils/
│       └── __tests__/           # Tests unitaires
│           ├── components/
│           ├── utils/
│           └── setup.ts
├── tests/
│   ├── e2e/                     # Tests Playwright
│   │   ├── blog.spec.ts
│   │   ├── search.spec.ts
│   │   └── fixtures/
│   └── integration/             # Tests d'intégration
├── dist/                        # JavaScript compilé
├── build/                       # Site JBake généré
├── package.json
├── vite.config.js
├── vitest.config.js
├── playwright.config.js
└── tsconfig.json</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuration_des_tests_unitaires_avec_vitest">4. Configuration des tests unitaires avec Vitest</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="installation_des_dépendances">4.1. Installation des dépendances</h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash"># Tests unitaires avec Vitest
npm install -D vitest jsdom @vitest/ui

# Utilitaires de test
npm install -D @testing-library/dom @testing-library/user-event
npm install -D @types/jsdom

# Mocking et assertions avancées
npm install -D msw</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuration_vitest">4.2. Configuration Vitest</h3>
<div class="paragraph">
<p>Créez le fichier <code>vitest.config.js</code> :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><span style="color:#080;font-weight:bold">import</span> { defineConfig } from <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">vitest/config</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">import</span> { resolve } from <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">path</span><span style="color:#710">'</span></span>

<span style="color:#080;font-weight:bold">export</span> <span style="color:#080;font-weight:bold">default</span> defineConfig({
  <span style="color:#606">test</span>: {
    <span style="color:#606">environment</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">jsdom</span><span style="color:#710">'</span></span>,
    <span style="color:#606">setupFiles</span>: [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">src/ts/__tests__/setup.ts</span><span style="color:#710">'</span></span>],
    <span style="color:#606">globals</span>: <span style="color:#069">true</span>,
    <span style="color:#606">css</span>: <span style="color:#069">true</span>,
    <span style="color:#606">coverage</span>: {
      <span style="color:#606">provider</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">v8</span><span style="color:#710">'</span></span>,
      <span style="color:#606">reporter</span>: [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">text</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">html</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">lcov</span><span style="color:#710">'</span></span>],
      <span style="color:#606">exclude</span>: [
        <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">node_modules/</span><span style="color:#710">'</span></span>,
        <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">dist/</span><span style="color:#710">'</span></span>,
        <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">build/</span><span style="color:#710">'</span></span>,
        <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">tests/</span><span style="color:#710">'</span></span>,
        <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">**/*.config.js</span><span style="color:#710">'</span></span>,
        <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">**/*.d.ts</span><span style="color:#710">'</span></span>
      ]
    }
  },
  <span style="color:#606">resolve</span>: {
    <span style="color:#606">alias</span>: {
      <span style="color:#606"><span style="color:#404">'</span><span>@</span><span style="color:#404">'</span></span>: resolve(__dirname, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">src/ts</span><span style="color:#710">'</span></span>)
    }
  }
})</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="fichier_de_setup_des_tests">4.3. Fichier de setup des tests</h3>
<div class="paragraph">
<p>Créez <code>src/ts/<em>tests</em>/setup.ts</code> :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript">import { vi } from 'vitest'
import '@testing-library/jest-dom'

// Mock des APIs du navigateur non disponibles dans jsdom
Object.defineProperty(window, 'matchMedia', {
  writable: true,
  value: vi.fn().mockImplementation(query =&gt; ({
    matches: false,
    media: query,
    onchange: null,
    addListener: vi.fn(),
    removeListener: vi.fn(),
    addEventListener: vi.fn(),
    removeEventListener: vi.fn(),
    dispatchEvent: vi.fn(),
  })),
})

// Mock fetch global
global.fetch = vi.fn()

// Mock pour localStorage
const localStorageMock = {
  getItem: vi.fn(),
  setItem: vi.fn(),
  removeItem: vi.fn(),
  clear: vi.fn(),
}
Object.defineProperty(window, 'localStorage', {
  value: localStorageMock
})

// Nettoyage entre les tests
beforeEach(() =&gt; {
  document.body.innerHTML = ''
  vi.clearAllMocks()
})</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="tests_unitaires_exemples_pratiques">5. Tests unitaires : Exemples pratiques</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="test_dune_classe_utilitaire">5.1. Test d&#8217;une classe utilitaire</h3>
<div class="paragraph">
<p>Créez <code>src/ts/utils/SearchUtils.ts</code> :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript">export interface SearchResult {
  title: string;
  url: string;
  excerpt: string;
  score: number;
}

export class SearchUtils {
  static filterResults(
    results: SearchResult[],
    minScore: number = 0.5
  ): SearchResult[] {
    return results
      .filter(result =&gt; result.score &gt;= minScore)
      .sort((a, b) =&gt; b.score - a.score);
  }

  static highlightMatches(text: string, query: string): string {
    if (!query.trim()) return text;

    const regex = new RegExp(`(${this.escapeRegex(query)})`, 'gi');
    return text.replace(regex, '&lt;mark&gt;$1&lt;/mark&gt;');
  }

  static escapeRegex(string: string): string {
    return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&amp;');
  }

  static debounce&lt;T extends (...args: any[]) =&gt; any&gt;(
    func: T,
    delay: number
  ): (...args: Parameters&lt;T&gt;) =&gt; void {
    let timeoutId: ReturnType&lt;typeof setTimeout&gt;;

    return (...args: Parameters&lt;T&gt;) =&gt; {
      clearTimeout(timeoutId);
      timeoutId = setTimeout(() =&gt; func(...args), delay);
    };
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Test correspondant <code>src/ts/<em>tests</em>/utils/SearchUtils.test.ts</code> :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript">import { describe, it, expect, vi, beforeEach, afterEach } from 'vitest'
import { SearchUtils, type SearchResult } from '@/utils/SearchUtils'

describe('SearchUtils', () =&gt; {
  const mockResults: SearchResult[] = [
    { title: 'Article 1', url: '/article-1', excerpt: 'Premier article', score: 0.8 },
    { title: 'Article 2', url: '/article-2', excerpt: 'Deuxième article', score: 0.3 },
    { title: 'Article 3', url: '/article-3', excerpt: 'Troisième article', score: 0.9 },
  ]

  describe('filterResults', () =&gt; {
    it('should filter results by minimum score', () =&gt; {
      const filtered = SearchUtils.filterResults(mockResults, 0.5)

      expect(filtered).toHaveLength(2)
      expect(filtered[0].title).toBe('Article 3') // Score le plus élevé en premier
      expect(filtered[1].title).toBe('Article 1')
    })

    it('should use default minimum score of 0.5', () =&gt; {
      const filtered = SearchUtils.filterResults(mockResults)

      expect(filtered).toHaveLength(2)
    })

    it('should return empty array when no results meet minimum score', () =&gt; {
      const filtered = SearchUtils.filterResults(mockResults, 1.0)

      expect(filtered).toHaveLength(0)
    })

    it('should sort results by score in descending order', () =&gt; {
      const filtered = SearchUtils.filterResults(mockResults, 0.1)

      expect(filtered[0].score).toBe(0.9)
      expect(filtered[1].score).toBe(0.8)
      expect(filtered[2].score).toBe(0.3)
    })
  })

  describe('highlightMatches', () =&gt; {
    it('should highlight matching text', () =&gt; {
      const result = SearchUtils.highlightMatches('TypeScript est formidable', 'TypeScript')

      expect(result).toBe('&lt;mark&gt;TypeScript&lt;/mark&gt; est formidable')
    })

    it('should be case insensitive', () =&gt; {
      const result = SearchUtils.highlightMatches('TypeScript est formidable', 'typescript')

      expect(result).toBe('&lt;mark&gt;TypeScript&lt;/mark&gt; est formidable')
    })

    it('should handle multiple matches', () =&gt; {
      const result = SearchUtils.highlightMatches('TypeScript et typescript', 'typescript')

      expect(result).toBe('&lt;mark&gt;TypeScript&lt;/mark&gt; et &lt;mark&gt;typescript&lt;/mark&gt;')
    })

    it('should handle empty query', () =&gt; {
      const text = 'TypeScript est formidable'
      const result = SearchUtils.highlightMatches(text, '')

      expect(result).toBe(text)
    })

    it('should escape regex special characters', () =&gt; {
      const result = SearchUtils.highlightMatches('Test (regex)', '(regex)')

      expect(result).toBe('Test &lt;mark&gt;(regex)&lt;/mark&gt;')
    })
  })

  describe('debounce', () =&gt; {
    beforeEach(() =&gt; {
      vi.useFakeTimers()
    })

    afterEach(() =&gt; {
      vi.useRealTimers()
    })

    it('should delay function execution', () =&gt; {
      const mockFn = vi.fn()
      const debouncedFn = SearchUtils.debounce(mockFn, 100)

      debouncedFn('test')
      expect(mockFn).not.toHaveBeenCalled()

      vi.advanceTimersByTime(100)
      expect(mockFn).toHaveBeenCalledWith('test')
    })

    it('should cancel previous calls', () =&gt; {
      const mockFn = vi.fn()
      const debouncedFn = SearchUtils.debounce(mockFn, 100)

      debouncedFn('first')
      debouncedFn('second')

      vi.advanceTimersByTime(100)

      expect(mockFn).toHaveBeenCalledTimes(1)
      expect(mockFn).toHaveBeenCalledWith('second')
    })
  })
})</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="test_dun_composant_avec_dom">5.2. Test d&#8217;un composant avec DOM</h3>
<div class="paragraph">
<p>Test pour la classe <code>BlogSearch</code> <code>src/ts/<em>tests</em>/components/BlogSearch.test.ts</code> :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript">import { describe, it, expect, vi, beforeEach } from 'vitest'
import { screen, fireEvent, waitFor } from '@testing-library/dom'
import userEvent from '@testing-library/user-event'
import { BlogSearch } from '@/components/BlogSearch'

// Mock des réponses API
const mockSearchResponse = {
  items: [
    {
      title: 'Premier article',
      url: '/article-1',
      excerpt: 'Description du premier article'
    }
  ],
  total: 1
}

describe('BlogSearch', () =&gt; {
  let container: HTMLElement
  let user: ReturnType&lt;typeof userEvent.setup&gt;

  beforeEach(() =&gt; {
    user = userEvent.setup()

    // Setup DOM
    document.body.innerHTML = `
      &lt;div&gt;
        &lt;input type=&quot;search&quot; id=&quot;search&quot; placeholder=&quot;Rechercher...&quot;&gt;
        &lt;div id=&quot;search-results&quot; class=&quot;search-results-container&quot;&gt;&lt;/div&gt;
      &lt;/div&gt;
    `

    container = document.body.firstElementChild as HTMLElement

    // Mock fetch
    global.fetch = vi.fn().mockResolvedValue({
      ok: true,
      json: () =&gt; Promise.resolve(mockSearchResponse)
    } as Response)
  })

  it('should initialize without errors', () =&gt; {
    expect(() =&gt; new BlogSearch()).not.toThrow()
  })

  it('should throw error if required elements are missing', () =&gt; {
    document.body.innerHTML = '&lt;div&gt;&lt;/div&gt;'

    expect(() =&gt; new BlogSearch()).toThrow('Required elements not found')
  })

  it('should perform search when input has sufficient length', async () =&gt; {
    new BlogSearch({ minLength: 2, debounceMs: 0 })

    const searchInput = screen.getByPlaceholderText('Rechercher...')

    await user.type(searchInput, 'typescript')

    await waitFor(() =&gt; {
      expect(fetch).toHaveBeenCalledWith('/search.json?q=typescript')
    })
  })

  it('should not search if input is too short', async () =&gt; {
    new BlogSearch({ minLength: 3, debounceMs: 0 })

    const searchInput = screen.getByPlaceholderText('Rechercher...')

    await user.type(searchInput, 'ts')

    expect(fetch).not.toHaveBeenCalled()
  })

  it('should display search results', async () =&gt; {
    new BlogSearch({ minLength: 2, debounceMs: 0 })

    const searchInput = screen.getByPlaceholderText('Rechercher...')

    await user.type(searchInput, 'typescript')

    await waitFor(() =&gt; {
      expect(screen.getByText('Premier article')).toBeInTheDocument()
      expect(screen.getByText('1 résultat(s)')).toBeInTheDocument()
    })
  })

  it('should handle API errors gracefully', async () =&gt; {
    global.fetch = vi.fn().mockRejectedValue(new Error('Network error'))

    // Spy sur console.error pour vérifier le logging
    const consoleSpy = vi.spyOn(console, 'error').mockImplementation(() =&gt; {})

    new BlogSearch({ minLength: 2, debounceMs: 0 })

    const searchInput = screen.getByPlaceholderText('Rechercher...')

    await user.type(searchInput, 'typescript')

    await waitFor(() =&gt; {
      expect(screen.getByText('Erreur lors de la recherche')).toBeInTheDocument()
      expect(consoleSpy).toHaveBeenCalledWith('Search failed:', expect.any(Error))
    })

    consoleSpy.mockRestore()
  })

  it('should clear results when pressing Escape', async () =&gt; {
    new BlogSearch({ minLength: 2, debounceMs: 0 })

    const searchInput = screen.getByPlaceholderText('Rechercher...')

    // Effectuer une recherche d'abord
    await user.type(searchInput, 'typescript')

    await waitFor(() =&gt; {
      expect(screen.getByText('Premier article')).toBeInTheDocument()
    })

    // Appuyer sur Escape
    await user.keyboard('{Escape}')

    const resultsContainer = document.getElementById('search-results')!
    expect(resultsContainer.innerHTML).toBe('')
    expect(resultsContainer.classList.contains('visible')).toBe(false)
  })

  it('should escape HTML in results', async () =&gt; {
    const maliciousResponse = {
      items: [{
        title: '&lt;script&gt;alert(&quot;xss&quot;)&lt;/script&gt;',
        url: '/safe-url',
        excerpt: 'Safe excerpt'
      }],
      total: 1
    }

    global.fetch = vi.fn().mockResolvedValue({
      ok: true,
      json: () =&gt; Promise.resolve(maliciousResponse)
    } as Response)

    new BlogSearch({ minLength: 2, debounceMs: 0 })

    const searchInput = screen.getByPlaceholderText('Rechercher...')

    await user.type(searchInput, 'test')

    await waitFor(() =&gt; {
      // Vérifier que le script n'est pas exécuté
      expect(document.body.innerHTML).toContain('&amp;lt;script&amp;gt;')
      expect(document.body.innerHTML).not.toContain('&lt;script&gt;')
    })
  })
})</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuration_des_tests_e2e_avec_playwright">6. Configuration des tests E2E avec Playwright</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="installation_de_playwright">6.1. Installation de Playwright</h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">npm install -D @playwright/test
npx playwright install</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuration_playwright">6.2. Configuration Playwright</h3>
<div class="paragraph">
<p>Créez <code>playwright.config.js</code> :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><span style="color:#080;font-weight:bold">import</span> { defineConfig, devices } from <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">@playwright/test</span><span style="color:#710">'</span></span>

<span style="color:#080;font-weight:bold">export</span> <span style="color:#080;font-weight:bold">default</span> defineConfig({
  <span style="color:#606">testDir</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">./tests/e2e</span><span style="color:#710">'</span></span>,
  <span style="color:#606">fullyParallel</span>: <span style="color:#069">true</span>,
  <span style="color:#606">forbidOnly</span>: !!process.env.CI,
  <span style="color:#606">retries</span>: process.env.CI ? <span style="color:#00D">2</span> : <span style="color:#00D">0</span>,
  <span style="color:#606">workers</span>: process.env.CI ? <span style="color:#00D">1</span> : <span style="color:#069">undefined</span>,
  <span style="color:#606">reporter</span>: [
    [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">html</span><span style="color:#710">'</span></span>],
    [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">json</span><span style="color:#710">'</span></span>, { <span style="color:#606">outputFile</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">test-results/results.json</span><span style="color:#710">'</span></span> }]
  ],
  <span style="color:#606">use</span>: {
    <span style="color:#606">baseURL</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">http://localhost:8820</span><span style="color:#710">'</span></span>,
    <span style="color:#606">trace</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">on-first-retry</span><span style="color:#710">'</span></span>,
    <span style="color:#606">screenshot</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">only-on-failure</span><span style="color:#710">'</span></span>,
  },

  <span style="color:#606">projects</span>: [
    {
      <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">chromium</span><span style="color:#710">'</span></span>,
      <span style="color:#606">use</span>: { ...devices[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Desktop Chrome</span><span style="color:#710">'</span></span>] },
    },
    {
      <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">firefox</span><span style="color:#710">'</span></span>,
      <span style="color:#606">use</span>: { ...devices[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Desktop Firefox</span><span style="color:#710">'</span></span>] },
    },
    {
      <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">webkit</span><span style="color:#710">'</span></span>,
      <span style="color:#606">use</span>: { ...devices[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Desktop Safari</span><span style="color:#710">'</span></span>] },
    },
    {
      <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Mobile Chrome</span><span style="color:#710">'</span></span>,
      <span style="color:#606">use</span>: { ...devices[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Pixel 5</span><span style="color:#710">'</span></span>] },
    },
    {
      <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Mobile Safari</span><span style="color:#710">'</span></span>,
      <span style="color:#606">use</span>: { ...devices[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">iPhone 12</span><span style="color:#710">'</span></span>] },
    },
  ],

  <span style="color:#606">webServer</span>: [
    {
      <span style="color:#606">command</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">npm run build &amp;&amp; npx jbake -s</span><span style="color:#710">'</span></span>,
      <span style="color:#606">port</span>: <span style="color:#00D">8820</span>,
      <span style="color:#606">reuseExistingServer</span>: !process.env.CI,
    }
  ],
})</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="tests_e2e_navigation_et_recherche">6.3. Tests E2E : Navigation et recherche</h3>
<div class="paragraph">
<p>Créez <code>tests/e2e/blog.spec.ts</code> :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript">import { test, expect } from '@playwright/test'

test.describe('Blog Navigation', () =&gt; {
  test('should load homepage', async ({ page }) =&gt; {
    await page.goto('/')

    await expect(page).toHaveTitle(/Mon Blog/)
    await expect(page.locator('h1')).toBeVisible()
  })

  test('should navigate to blog posts', async ({ page }) =&gt; {
    await page.goto('/')

    // Cliquer sur un lien d'article
    await page.click('a[href*=&quot;/blog/&quot;]')

    // Vérifier que nous sommes sur une page d'article
    await expect(page.locator('article')).toBeVisible()
    await expect(page.locator('.post-content')).toBeVisible()
  })

  test('should have working RSS feed', async ({ page }) =&gt; {
    const response = await page.goto('/feed.xml')

    expect(response?.status()).toBe(200)
    expect(response?.headers()['content-type']).toContain('xml')
  })
})

test.describe('Responsive Design', () =&gt; {
  test('should be mobile friendly', async ({ page }) =&gt; {
    await page.setViewportSize({ width: 375, height: 667 })
    await page.goto('/')

    // Vérifier que le menu mobile fonctionne
    const menuButton = page.locator('[data-testid=&quot;mobile-menu&quot;]')
    if (await menuButton.isVisible()) {
      await menuButton.click()
      await expect(page.locator('.mobile-menu')).toBeVisible()
    }
  })

  test('should adapt layout on tablet', async ({ page }) =&gt; {
    await page.setViewportSize({ width: 768, height: 1024 })
    await page.goto('/')

    await expect(page.locator('.container')).toHaveCSS('max-width', '768px')
  })
})</code></pre>
</div>
</div>
<div class="paragraph">
<p>Créez <code>tests/e2e/search.spec.ts</code> :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript">import { test, expect } from '@playwright/test'

test.describe('Search Functionality', () =&gt; {
  test.beforeEach(async ({ page }) =&gt; {
    // Mocker l'API de recherche
    await page.route('/search.json*', async route =&gt; {
      const url = route.request().url()
      const query = new URL(url).searchParams.get('q')

      const mockResponse = {
        items: query ? [
          {
            title: `Résultat pour &quot;${query}&quot;`,
            url: '/blog/test-article',
            excerpt: `Ceci est un extrait contenant ${query}`
          }
        ] : [],
        total: query ? 1 : 0
      }

      await route.fulfill({
        status: 200,
        contentType: 'application/json',
        body: JSON.stringify(mockResponse)
      })
    })

    await page.goto('/')
  })

  test('should show search results', async ({ page }) =&gt; {
    const searchInput = page.locator('#search')
    const resultsContainer = page.locator('#search-results')

    await searchInput.fill('typescript')

    // Attendre que les résultats apparaissent
    await expect(resultsContainer).toBeVisible()
    await expect(page.locator('.search-result')).toHaveCount(1)
    await expect(page.getByText('Résultat pour &quot;typescript&quot;')).toBeVisible()
  })

  test('should handle empty search results', async ({ page }) =&gt; {
    await page.route('/search.json*', async route =&gt; {
      await route.fulfill({
        status: 200,
        contentType: 'application/json',
        body: JSON.stringify({ items: [], total: 0 })
      })
    })

    const searchInput = page.locator('#search')

    await searchInput.fill('nonexistent')

    await expect(page.getByText('Aucun résultat trouvé')).toBeVisible()
  })

  test('should close search results with Escape', async ({ page }) =&gt; {
    const searchInput = page.locator('#search')
    const resultsContainer = page.locator('#search-results')

    // Effectuer une recherche
    await searchInput.fill('typescript')
    await expect(resultsContainer).toBeVisible()

    // Appuyer sur Escape
    await page.keyboard.press('Escape')

    await expect(resultsContainer).not.toHaveClass(/visible/)
  })

  test('should handle search API errors', async ({ page }) =&gt; {
    await page.route('/search.json*', async route =&gt; {
      await route.fulfill({
        status: 500,
        contentType: 'application/json',
        body: JSON.stringify({ error: 'Internal Server Error' })
      })
    })

    // Spy sur les erreurs console
    const consoleErrors: string[] = []
    page.on('console', msg =&gt; {
      if (msg.type() === 'error') {
        consoleErrors.push(msg.text())
      }
    })

    const searchInput = page.locator('#search')

    await searchInput.fill('error')

    await expect(page.getByText('Erreur lors de la recherche')).toBeVisible()

    // Vérifier qu'une erreur a été loggée
    await page.waitForTimeout(100)
    expect(consoleErrors.some(error =&gt; error.includes('Search failed'))).toBe(true)
  })

  test('should debounce search requests', async ({ page }) =&gt; {
    let requestCount = 0

    await page.route('/search.json*', async route =&gt; {
      requestCount++
      await route.fulfill({
        status: 200,
        contentType: 'application/json',
        body: JSON.stringify({ items: [], total: 0 })
      })
    })

    const searchInput = page.locator('#search')

    // Taper rapidement plusieurs caractères
    await searchInput.pressSequentially('typescript', { delay: 50 })

    // Attendre que le debounce se termine
    await page.waitForTimeout(500)

    // Vérifier qu'une seule requête a été envoyée
    expect(requestCount).toBe(1)
  })
})

test.describe('Search Accessibility', () =&gt; {
  test('should be keyboard navigable', async ({ page }) =&gt; {
    await page.goto('/')

    // Naviguer au champ de recherche avec Tab
    await page.keyboard.press('Tab')
    await expect(page.locator('#search')).toBeFocused()

    // Effectuer une recherche
    await page.keyboard.type('typescript')

    // Vérifier que les résultats sont accessibles au clavier
    await page.keyboard.press('Tab')
    await expect(page.locator('.search-result a').first()).toBeFocused()
  })

  test('should have proper ARIA attributes', async ({ page }) =&gt; {
    await page.goto('/')

    const searchInput = page.locator('#search')
    const resultsContainer = page.locator('#search-results')

    // Vérifier les attributs ARIA
    await expect(searchInput).toHaveAttribute('role', 'searchbox')
    await expect(resultsContainer).toHaveAttribute('role', 'region')
    await expect(resultsContainer).toHaveAttribute('aria-live', 'polite')
  })
})</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="scripts_de_test_intégrés">7. Scripts de test intégrés</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Mettez à jour votre <code>package.json</code> :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span style="color:#606"><span style="color:#404">&quot;</span><span>scripts</span><span style="color:#404">&quot;</span></span>: {
    <span style="color:#606"><span style="color:#404">&quot;</span><span>dev:ts</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">vite</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>build:ts</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">vite build</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>dev</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">concurrently </span><span style="color:#b0b">\&quot;</span><span style="color:#D20">npm run dev:ts</span><span style="color:#b0b">\&quot;</span><span style="color:#D20"> </span><span style="color:#b0b">\&quot;</span><span style="color:#D20">./gradlew jbakeServe</span><span style="color:#b0b">\&quot;</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>build</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">npm run build:ts &amp;&amp; ./gradlew jbake</span><span style="color:#710">&quot;</span></span>,

    <span style="color:#606"><span style="color:#404">&quot;</span><span>test</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">vitest</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>test:ui</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">vitest --ui</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>test:coverage</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">vitest --coverage</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>test:watch</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">vitest --watch</span><span style="color:#710">&quot;</span></span>,

    <span style="color:#606"><span style="color:#404">&quot;</span><span>test:e2e</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">playwright test</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>test:e2e:ui</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">playwright test --ui</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>test:e2e:headed</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">playwright test --headed</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>test:e2e:debug</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">playwright test --debug</span><span style="color:#710">&quot;</span></span>,

    <span style="color:#606"><span style="color:#404">&quot;</span><span>test:all</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">npm run test:coverage &amp;&amp; npm run test:e2e</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>test:ci</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">npm run build &amp;&amp; npm run test:coverage &amp;&amp; npm run test:e2e</span><span style="color:#710">&quot;</span></span>
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="intégration_avec_le_build_gradle">8. Intégration avec le build Gradle</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Mettez à jour votre <code>build.gradle</code> :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">org.jbake.site</span><span style="color:#710">'</span></span> version <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">5.3.0</span><span style="color:#710">'</span></span>
    id <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">com.github.node-gradle.node</span><span style="color:#710">'</span></span> version <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">3.5.1</span><span style="color:#710">'</span></span>
}

<span style="color:#777">// Tasks de test</span>
task testUnit(<span style="color:#606">type</span>: NpmTask) {
    args = [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">run</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">test:coverage</span><span style="color:#710">'</span></span>]
    inputs.dir(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">src/ts</span><span style="color:#710">'</span></span>)
    outputs.dir(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">coverage</span><span style="color:#710">'</span></span>)
}

task testE2E(<span style="color:#606">type</span>: NpmTask) {
    args = [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">run</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">test:e2e</span><span style="color:#710">'</span></span>]
    inputs.dir(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">tests/e2e</span><span style="color:#710">'</span></span>)
    inputs.dir(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">build</span><span style="color:#710">'</span></span>) <span style="color:#777">// Dépend du site généré</span>
    outputs.dir(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">test-results</span><span style="color:#710">'</span></span>)
    dependsOn jbake
}

task testAll(<span style="color:#606">type</span>: NpmTask) {
    args = [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">run</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">test:all</span><span style="color:#710">'</span></span>]
    dependsOn buildTypeScript
}

<span style="color:#777">// Configuration des dépendances</span>
buildTypeScript.dependsOn npmInstall
testUnit.dependsOn buildTypeScript
jbake.dependsOn testUnit  <span style="color:#777">// Les tests doivent passer avant le build</span>

<span style="color:#777">// Task pour le pipeline CI/CD</span>
task ciPipeline {
    dependsOn testAll
    description = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Pipeline complet : build, tests unitaires et E2E</span><span style="color:#710">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="intégration_cicd">9. Intégration CI/CD</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="github_actions">9.1. GitHub Actions</h3>
<div class="paragraph">
<p>Créez <code>.github/workflows/test.yml</code> :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">Tests</span></span>

<span style="color:#606">on</span>:
  <span style="color:#606">push</span>:
    <span style="color:#606">branches</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">[ main, develop ]</span></span>
  <span style="color:#606">pull_request</span>:
    <span style="color:#606">branches</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">[ main ]</span></span>

<span style="color:#606">jobs</span>:
  <span style="color:#606">test</span>:
    <span style="color:#606">runs-on</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">ubuntu-latest</span></span>

    <span style="color:#606">strategy</span>:
      <span style="color:#606">matrix</span>:
        <span style="color:#606">node-version</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">[18, 20]</span></span>

    <span style="color:#606">steps</span>:
    - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">uses: actions/checkout@v4</span></span>

    - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">name: Setup Node.js ${{ matrix.node-version }}</span></span>
      <span style="color:#606">uses</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">actions/setup-node@v4</span></span>
      <span style="color:#606">with</span>:
        <span style="color:#606">node-version</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">${{ matrix.node-version }}</span></span>
        <span style="color:#606">cache</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">'npm'</span></span>

    - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">name: Setup Java</span></span>
      <span style="color:#606">uses</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">actions/setup-java@v4</span></span>
      <span style="color:#606">with</span>:
        <span style="color:#606">java-version</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">'17'</span></span>
        <span style="color:#606">distribution</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">'temurin'</span></span>

    - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">name: Install dependencies</span></span>
      <span style="color:#606">run</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">npm ci</span></span>

    - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">name: Run unit tests</span></span>
      <span style="color:#606">run</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">npm run test:coverage</span></span>

    - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">name: Build site</span></span>
      <span style="color:#606">run</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">./gradlew jbake</span></span>

    - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">name: Install Playwright browsers</span></span>
      <span style="color:#606">run</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">npx playwright install --with-deps</span></span>

    - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">name: Run E2E tests</span></span>
      <span style="color:#606">run</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">npm run test:e2e</span></span>

    - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">name: Upload coverage reports</span></span>
      <span style="color:#606">uses</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">codecov/codecov-action@v4</span></span>
      <span style="color:#606">with</span>:
        <span style="color:#606">file</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">./coverage/lcov.info</span></span>

    - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">name: Upload test results</span></span>
      <span style="color:#606">uses</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">actions/upload-artifact@v4</span></span>
      <span style="color:#606">if</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">always()</span></span>
      <span style="color:#606">with</span>:
        <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">playwright-report-${{ matrix.node-version }}</span></span>
        <span style="color:#606">path</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">playwright-report/</span></span>
        <span style="color:#606">retention-days</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">30</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="bonnes_pratiques_de_test">10. Bonnes pratiques de test</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="tests_unitaires">10.1. Tests unitaires</h3>
<div class="ulist">
<ul>
<li>
<p><strong>Testez la logique métier</strong> - Pas les détails d&#8217;implémentation</p>
</li>
<li>
<p><strong>Un test = un comportement</strong> - Tests focalisés et lisibles</p>
</li>
<li>
<p><strong>Arrange, Act, Assert</strong> - Structure claire des tests</p>
</li>
<li>
<p><strong>Mockez les dépendances externes</strong> - Tests isolés et rapides</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="tests_dintégration">10.2. Tests d&#8217;intégration</h3>
<div class="ulist">
<ul>
<li>
<p><strong>Testez les interactions</strong> - Entre composants et avec le DOM</p>
</li>
<li>
<p><strong>Simulez les conditions réelles</strong> - Événements utilisateur authentiques</p>
</li>
<li>
<p><strong>Vérifiez les effets de bord</strong> - État global, stockage local, etc.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="tests_e2e">10.3. Tests E2E</h3>
<div class="ulist">
<ul>
<li>
<p><strong>Testez les parcours critiques</strong> - Workflows métier importants</p>
</li>
<li>
<p><strong>Tests stables</strong> - Utilisez des sélecteurs robustes</p>
</li>
<li>
<p><strong>Données de test isolées</strong> - Évitez les dépendances entre tests</p>
</li>
<li>
<p><strong>Performance</strong> - Limitez le nombre de tests E2E</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="organisation_des_tests">10.4. Organisation des tests</h3>
<div class="sect3">
<h4 id="tester_votre_code_typescript_dans_jbake_tests_unitaires_avec_vitest_et_tests_e2e_avec_playwright">10.4.1. Tester votre code TypeScript dans JBake : Tests unitaires avec Vitest et tests E2E avec Playwright</h4>
<div class="paragraph">
<p>Dans la <a href="/blog/2025/integrer-typescript-jbake-vite.html">première partie</a> de cette série, nous avons vu comment intégrer TypeScript dans JBake avec Vite.
Maintenant, nous allons ajouter une stratégie de test complète avec des tests unitaires via Vitest et des tests end-to-end avec Playwright.</p>
</div>
<div class="sect4">
<h5 id="pourquoi_tester_dans_un_contexte_jbake_2">10.4.1.1. Pourquoi tester dans un contexte JBake ?</h5>
<div class="paragraph">
<p>Même pour un site statique, les tests apportent une valeur considérable :</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Tests unitaires</strong> - Validez la logique métier de vos composants TypeScript</p>
</li>
<li>
<p><strong>Tests d&#8217;intégration</strong> - Vérifiez les interactions entre composants</p>
</li>
<li>
<p><strong>Tests E2E</strong> - Assurez-vous que l&#8217;expérience utilisateur fonctionne correctement</p>
</li>
<li>
<p><strong>Régression</strong> - Détectez automatiquement les cassures lors des modifications</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="architecture_de_test_2">10.4.2. Architecture de test</h4>
<div class="paragraph">
<p>Notre stratégie de test suit la pyramide classique :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>        /\
       /  \     Tests E2E (Playwright)
      /____\    - Navigation
     /      \   - Workflows utilisateur
    /        \  - Tests cross-browser
   /__________\
  /            \ Tests d'intégration (Vitest + jsdom)
 /              \ - Interactions DOM
/________________\ - API calls mockées
|                |
|  Tests unitaires| Tests unitaires (Vitest)
|   (Vitest)     | - Logique métier
|________________| - Fonctions pures</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="structure_du_projet_mise_à_jour_2">10.4.3. Structure du projet mise à jour</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>mon-blog/
├── src/
│   ├── main/jbake/              # JBake standard
│   └── ts/                      # Sources TypeScript
│       ├── components/
│       ├── utils/
│       └── __tests__/           # Tests unitaires
│           ├── components/
│           ├── utils/
│           └── setup.ts
├── tests/
│   ├── e2e/                     # Tests Playwright
│   │   ├── blog.spec.ts
│   │   ├── search.spec.ts
│   │   └── fixtures/
│   └── integration/             # Tests d'intégration
├── dist/                        # JavaScript compilé
├── build/                       # Site JBake généré
├── package.json
├── vite.config.js
├── vitest.config.js
├── playwright.config.js
└── tsconfig.json</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuration_des_tests_unitaires_avec_vitest_2">11. Configuration des tests unitaires avec Vitest</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="installation_des_dépendances_2">11.1. Installation des dépendances</h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash"># Tests unitaires avec Vitest
npm install -D vitest jsdom @vitest/ui

# Utilitaires de test
npm install -D @testing-library/dom @testing-library/user-event
npm install -D @types/jsdom

# Mocking et assertions avancées
npm install -D msw</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuration_vitest_2">11.2. Configuration Vitest</h3>
<div class="paragraph">
<p>Créez le fichier <code>vitest.config.js</code> :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><span style="color:#080;font-weight:bold">import</span> { defineConfig } from <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">vitest/config</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">import</span> { resolve } from <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">path</span><span style="color:#710">'</span></span>

<span style="color:#080;font-weight:bold">export</span> <span style="color:#080;font-weight:bold">default</span> defineConfig({
  <span style="color:#606">test</span>: {
    <span style="color:#606">environment</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">jsdom</span><span style="color:#710">'</span></span>,
    <span style="color:#606">setupFiles</span>: [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">src/ts/__tests__/setup.ts</span><span style="color:#710">'</span></span>],
    <span style="color:#606">globals</span>: <span style="color:#069">true</span>,
    <span style="color:#606">css</span>: <span style="color:#069">true</span>,
    <span style="color:#606">coverage</span>: {
      <span style="color:#606">provider</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">v8</span><span style="color:#710">'</span></span>,
      <span style="color:#606">reporter</span>: [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">text</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">html</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">lcov</span><span style="color:#710">'</span></span>],
      <span style="color:#606">exclude</span>: [
        <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">node_modules/</span><span style="color:#710">'</span></span>,
        <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">dist/</span><span style="color:#710">'</span></span>,
        <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">build/</span><span style="color:#710">'</span></span>,
        <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">tests/</span><span style="color:#710">'</span></span>,
        <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">**/*.config.js</span><span style="color:#710">'</span></span>,
        <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">**/*.d.ts</span><span style="color:#710">'</span></span>
      ]
    }
  },
  <span style="color:#606">resolve</span>: {
    <span style="color:#606">alias</span>: {
      <span style="color:#606"><span style="color:#404">'</span><span>@</span><span style="color:#404">'</span></span>: resolve(__dirname, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">src/ts</span><span style="color:#710">'</span></span>)
    }
  }
})</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="fichier_de_setup_des_tests_2">11.3. Fichier de setup des tests</h3>
<div class="paragraph">
<p>Créez <code>src/ts/<em>tests</em>/setup.ts</code> :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript">import { vi } from 'vitest'
import '@testing-library/jest-dom'

// Mock des APIs du navigateur non disponibles dans jsdom
Object.defineProperty(window, 'matchMedia', {
  writable: true,
  value: vi.fn().mockImplementation(query =&gt; ({
    matches: false,
    media: query,
    onchange: null,
    addListener: vi.fn(),
    removeListener: vi.fn(),
    addEventListener: vi.fn(),
    removeEventListener: vi.fn(),
    dispatchEvent: vi.fn(),
  })),
})

// Mock fetch global
global.fetch = vi.fn()

// Mock pour localStorage
const localStorageMock = {
  getItem: vi.fn(),
  setItem: vi.fn(),
  removeItem: vi.fn(),
  clear: vi.fn(),
}
Object.defineProperty(window, 'localStorage', {
  value: localStorageMock
})

// Nettoyage entre les tests
beforeEach(() =&gt; {
  document.body.innerHTML = ''
  vi.clearAllMocks()
})</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="tests_unitaires_exemples_pratiques_2">12. Tests unitaires : Exemples pratiques</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="test_dune_classe_utilitaire_2">12.1. Test d&#8217;une classe utilitaire</h3>
<div class="paragraph">
<p>Créez <code>src/ts/utils/SearchUtils.ts</code> :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript">export interface SearchResult {
  title: string;
  url: string;
  excerpt: string;
  score: number;
}

export class SearchUtils {
  static filterResults(
    results: SearchResult[],
    minScore: number = 0.5
  ): SearchResult[] {
    return results
      .filter(result =&gt; result.score &gt;= minScore)
      .sort((a, b) =&gt; b.score - a.score);
  }

  static highlightMatches(text: string, query: string): string {
    if (!query.trim()) return text;

    const regex = new RegExp(`(${this.escapeRegex(query)})`, 'gi');
    return text.replace(regex, '&lt;mark&gt;$1&lt;/mark&gt;');
  }

  static escapeRegex(string: string): string {
    return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&amp;');
  }

  static debounce&lt;T extends (...args: any[]) =&gt; any&gt;(
    func: T,
    delay: number
  ): (...args: Parameters&lt;T&gt;) =&gt; void {
    let timeoutId: ReturnType&lt;typeof setTimeout&gt;;

    return (...args: Parameters&lt;T&gt;) =&gt; {
      clearTimeout(timeoutId);
      timeoutId = setTimeout(() =&gt; func(...args), delay);
    };
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Test correspondant <code>src/ts/<em>tests</em>/utils/SearchUtils.test.ts</code> :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript">import { describe, it, expect, vi, beforeEach, afterEach } from 'vitest'
import { SearchUtils, type SearchResult } from '@/utils/SearchUtils'

describe('SearchUtils', () =&gt; {
  const mockResults: SearchResult[] = [
    { title: 'Article 1', url: '/article-1', excerpt: 'Premier article', score: 0.8 },
    { title: 'Article 2', url: '/article-2', excerpt: 'Deuxième article', score: 0.3 },
    { title: 'Article 3', url: '/article-3', excerpt: 'Troisième article', score: 0.9 },
  ]

  describe('filterResults', () =&gt; {
    it('should filter results by minimum score', () =&gt; {
      const filtered = SearchUtils.filterResults(mockResults, 0.5)

      expect(filtered).toHaveLength(2)
      expect(filtered[0].title).toBe('Article 3') // Score le plus élevé en premier
      expect(filtered[1].title).toBe('Article 1')
    })

    it('should use default minimum score of 0.5', () =&gt; {
      const filtered = SearchUtils.filterResults(mockResults)

      expect(filtered).toHaveLength(2)
    })

    it('should return empty array when no results meet minimum score', () =&gt; {
      const filtered = SearchUtils.filterResults(mockResults, 1.0)

      expect(filtered).toHaveLength(0)
    })

    it('should sort results by score in descending order', () =&gt; {
      const filtered = SearchUtils.filterResults(mockResults, 0.1)

      expect(filtered[0].score).toBe(0.9)
      expect(filtered[1].score).toBe(0.8)
      expect(filtered[2].score).toBe(0.3)
    })
  })

  describe('highlightMatches', () =&gt; {
    it('should highlight matching text', () =&gt; {
      const result = SearchUtils.highlightMatches('TypeScript est formidable', 'TypeScript')

      expect(result).toBe('&lt;mark&gt;TypeScript&lt;/mark&gt; est formidable')
    })

    it('should be case insensitive', () =&gt; {
      const result = SearchUtils.highlightMatches('TypeScript est formidable', 'typescript')

      expect(result).toBe('&lt;mark&gt;TypeScript&lt;/mark&gt; est formidable')
    })

    it('should handle multiple matches', () =&gt; {
      const result = SearchUtils.highlightMatches('TypeScript et typescript', 'typescript')

      expect(result).toBe('&lt;mark&gt;TypeScript&lt;/mark&gt; et &lt;mark&gt;typescript&lt;/mark&gt;')
    })

    it('should handle empty query', () =&gt; {
      const text = 'TypeScript est formidable'
      const result = SearchUtils.highlightMatches(text, '')

      expect(result).toBe(text)
    })

    it('should escape regex special characters', () =&gt; {
      const result = SearchUtils.highlightMatches('Test (regex)', '(regex)')

      expect(result).toBe('Test &lt;mark&gt;(regex)&lt;/mark&gt;')
    })
  })

  describe('debounce', () =&gt; {
    beforeEach(() =&gt; {
      vi.useFakeTimers()
    })

    afterEach(() =&gt; {
      vi.useRealTimers()
    })

    it('should delay function execution', () =&gt; {
      const mockFn = vi.fn()
      const debouncedFn = SearchUtils.debounce(mockFn, 100)

      debouncedFn('test')
      expect(mockFn).not.toHaveBeenCalled()

      vi.advanceTimersByTime(100)
      expect(mockFn).toHaveBeenCalledWith('test')
    })

    it('should cancel previous calls', () =&gt; {
      const mockFn = vi.fn()
      const debouncedFn = SearchUtils.debounce(mockFn, 100)

      debouncedFn('first')
      debouncedFn('second')

      vi.advanceTimersByTime(100)

      expect(mockFn).toHaveBeenCalledTimes(1)
      expect(mockFn).toHaveBeenCalledWith('second')
    })
  })
})</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="test_dun_composant_avec_dom_2">12.2. Test d&#8217;un composant avec DOM</h3>
<div class="paragraph">
<p>Test pour la classe <code>BlogSearch</code> <code>src/ts/<em>tests</em>/components/BlogSearch.test.ts</code> :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript">import { describe, it, expect, vi, beforeEach } from 'vitest'
import { screen, fireEvent, waitFor } from '@testing-library/dom'
import userEvent from '@testing-library/user-event'
import { BlogSearch } from '@/components/BlogSearch'

// Mock des réponses API
const mockSearchResponse = {
  items: [
    {
      title: 'Premier article',
      url: '/article-1',
      excerpt: 'Description du premier article'
    }
  ],
  total: 1
}

describe('BlogSearch', () =&gt; {
  let container: HTMLElement
  let user: ReturnType&lt;typeof userEvent.setup&gt;

  beforeEach(() =&gt; {
    user = userEvent.setup()

    // Setup DOM
    document.body.innerHTML = `
      &lt;div&gt;
        &lt;input type=&quot;search&quot; id=&quot;search&quot; placeholder=&quot;Rechercher...&quot;&gt;
        &lt;div id=&quot;search-results&quot; class=&quot;search-results-container&quot;&gt;&lt;/div&gt;
      &lt;/div&gt;
    `

    container = document.body.firstElementChild as HTMLElement

    // Mock fetch
    global.fetch = vi.fn().mockResolvedValue({
      ok: true,
      json: () =&gt; Promise.resolve(mockSearchResponse)
    } as Response)
  })

  it('should initialize without errors', () =&gt; {
    expect(() =&gt; new BlogSearch()).not.toThrow()
  })

  it('should throw error if required elements are missing', () =&gt; {
    document.body.innerHTML = '&lt;div&gt;&lt;/div&gt;'

    expect(() =&gt; new BlogSearch()).toThrow('Required elements not found')
  })

  it('should perform search when input has sufficient length', async () =&gt; {
    new BlogSearch({ minLength: 2, debounceMs: 0 })

    const searchInput = screen.getByPlaceholderText('Rechercher...')

    await user.type(searchInput, 'typescript')

    await waitFor(() =&gt; {
      expect(fetch).toHaveBeenCalledWith('/search.json?q=typescript')
    })
  })

  it('should not search if input is too short', async () =&gt; {
    new BlogSearch({ minLength: 3, debounceMs: 0 })

    const searchInput = screen.getByPlaceholderText('Rechercher...')

    await user.type(searchInput, 'ts')

    expect(fetch).not.toHaveBeenCalled()
  })

  it('should display search results', async () =&gt; {
    new BlogSearch({ minLength: 2, debounceMs: 0 })

    const searchInput = screen.getByPlaceholderText('Rechercher...')

    await user.type(searchInput, 'typescript')

    await waitFor(() =&gt; {
      expect(screen.getByText('Premier article')).toBeInTheDocument()
      expect(screen.getByText('1 résultat(s)')).toBeInTheDocument()
    })
  })

  it('should handle API errors gracefully', async () =&gt; {
    global.fetch = vi.fn().mockRejectedValue(new Error('Network error'))

    // Spy sur console.error pour vérifier le logging
    const consoleSpy = vi.spyOn(console, 'error').mockImplementation(() =&gt; {})

    new BlogSearch({ minLength: 2, debounceMs: 0 })

    const searchInput = screen.getByPlaceholderText('Rechercher...')

    await user.type(searchInput, 'typescript')

    await waitFor(() =&gt; {
      expect(screen.getByText('Erreur lors de la recherche')).toBeInTheDocument()
      expect(consoleSpy).toHaveBeenCalledWith('Search failed:', expect.any(Error))
    })

    consoleSpy.mockRestore()
  })

  it('should clear results when pressing Escape', async () =&gt; {
    new BlogSearch({ minLength: 2, debounceMs: 0 })

    const searchInput = screen.getByPlaceholderText('Rechercher...')

    // Effectuer une recherche d'abord
    await user.type(searchInput, 'typescript')

    await waitFor(() =&gt; {
      expect(screen.getByText('Premier article')).toBeInTheDocument()
    })

    // Appuyer sur Escape
    await user.keyboard('{Escape}')

    const resultsContainer = document.getElementById('search-results')!
    expect(resultsContainer.innerHTML).toBe('')
    expect(resultsContainer.classList.contains('visible')).toBe(false)
  })

  it('should escape HTML in results', async () =&gt; {
    const maliciousResponse = {
      items: [{
        title: '&lt;script&gt;alert(&quot;xss&quot;)&lt;/script&gt;',
        url: '/safe-url',
        excerpt: 'Safe excerpt'
      }],
      total: 1
    }

    global.fetch = vi.fn().mockResolvedValue({
      ok: true,
      json: () =&gt; Promise.resolve(maliciousResponse)
    } as Response)

    new BlogSearch({ minLength: 2, debounceMs: 0 })

    const searchInput = screen.getByPlaceholderText('Rechercher...')

    await user.type(searchInput, 'test')

    await waitFor(() =&gt; {
      // Vérifier que le script n'est pas exécuté
      expect(document.body.innerHTML).toContain('&amp;lt;script&amp;gt;')
      expect(document.body.innerHTML).not.toContain('&lt;script&gt;')
    })
  })
})</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuration_des_tests_e2e_avec_playwright_2">13. Configuration des tests E2E avec Playwright</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="installation_de_playwright_2">13.1. Installation de Playwright</h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">npm install -D @playwright/test
npx playwright install</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuration_playwright_2">13.2. Configuration Playwright</h3>
<div class="paragraph">
<p>Créez <code>playwright.config.js</code> :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><span style="color:#080;font-weight:bold">import</span> { defineConfig, devices } from <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">@playwright/test</span><span style="color:#710">'</span></span>

<span style="color:#080;font-weight:bold">export</span> <span style="color:#080;font-weight:bold">default</span> defineConfig({
  <span style="color:#606">testDir</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">./tests/e2e</span><span style="color:#710">'</span></span>,
  <span style="color:#606">fullyParallel</span>: <span style="color:#069">true</span>,
  <span style="color:#606">forbidOnly</span>: !!process.env.CI,
  <span style="color:#606">retries</span>: process.env.CI ? <span style="color:#00D">2</span> : <span style="color:#00D">0</span>,
  <span style="color:#606">workers</span>: process.env.CI ? <span style="color:#00D">1</span> : <span style="color:#069">undefined</span>,
  <span style="color:#606">reporter</span>: [
    [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">html</span><span style="color:#710">'</span></span>],
    [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">json</span><span style="color:#710">'</span></span>, { <span style="color:#606">outputFile</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">test-results/results.json</span><span style="color:#710">'</span></span> }]
  ],
  <span style="color:#606">use</span>: {
    <span style="color:#606">baseURL</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">http://localhost:8820</span><span style="color:#710">'</span></span>,
    <span style="color:#606">trace</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">on-first-retry</span><span style="color:#710">'</span></span>,
    <span style="color:#606">screenshot</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">only-on-failure</span><span style="color:#710">'</span></span>,
  },

  <span style="color:#606">projects</span>: [
    {
      <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">chromium</span><span style="color:#710">'</span></span>,
      <span style="color:#606">use</span>: { ...devices[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Desktop Chrome</span><span style="color:#710">'</span></span>] },
    },
    {
      <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">firefox</span><span style="color:#710">'</span></span>,
      <span style="color:#606">use</span>: { ...devices[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Desktop Firefox</span><span style="color:#710">'</span></span>] },
    },
    {
      <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">webkit</span><span style="color:#710">'</span></span>,
      <span style="color:#606">use</span>: { ...devices[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Desktop Safari</span><span style="color:#710">'</span></span>] },
    },
    {
      <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Mobile Chrome</span><span style="color:#710">'</span></span>,
      <span style="color:#606">use</span>: { ...devices[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Pixel 5</span><span style="color:#710">'</span></span>] },
    },
    {
      <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Mobile Safari</span><span style="color:#710">'</span></span>,
      <span style="color:#606">use</span>: { ...devices[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">iPhone 12</span><span style="color:#710">'</span></span>] },
    },
  ],

  <span style="color:#606">webServer</span>: [
    {
      <span style="color:#606">command</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">npm run build &amp;&amp; npx jbake -s</span><span style="color:#710">'</span></span>,
      <span style="color:#606">port</span>: <span style="color:#00D">8820</span>,
      <span style="color:#606">reuseExistingServer</span>: !process.env.CI,
    }
  ],
})</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="tests_e2e_navigation_et_recherche_2">13.3. Tests E2E : Navigation et recherche</h3>
<div class="paragraph">
<p>Créez <code>tests/e2e/blog.spec.ts</code> :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript">import { test, expect } from '@playwright/test'

test.describe('Blog Navigation', () =&gt; {
  test('should load homepage', async ({ page }) =&gt; {
    await page.goto('/')

    await expect(page).toHaveTitle(/Mon Blog/)
    await expect(page.locator('h1')).toBeVisible()
  })

  test('should navigate to blog posts', async ({ page }) =&gt; {
    await page.goto('/')

    // Cliquer sur un lien d'article
    await page.click('a[href*=&quot;/blog/&quot;]')

    // Vérifier que nous sommes sur une page d'article
    await expect(page.locator('article')).toBeVisible()
    await expect(page.locator('.post-content')).toBeVisible()
  })

  test('should have working RSS feed', async ({ page }) =&gt; {
    const response = await page.goto('/feed.xml')

    expect(response?.status()).toBe(200)
    expect(response?.headers()['content-type']).toContain('xml')
  })
})

test.describe('Responsive Design', () =&gt; {
  test('should be mobile friendly', async ({ page }) =&gt; {
    await page.setViewportSize({ width: 375, height: 667 })
    await page.goto('/')

    // Vérifier que le menu mobile fonctionne
    const menuButton = page.locator('[data-testid=&quot;mobile-menu&quot;]')
    if (await menuButton.isVisible()) {
      await menuButton.click()
      await expect(page.locator('.mobile-menu')).toBeVisible()
    }
  })

  test('should adapt layout on tablet', async ({ page }) =&gt; {
    await page.setViewportSize({ width: 768, height: 1024 })
    await page.goto('/')

    await expect(page.locator('.container')).toHaveCSS('max-width', '768px')
  })
})</code></pre>
</div>
</div>
<div class="paragraph">
<p>Créez <code>tests/e2e/search.spec.ts</code> :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript">import { test, expect } from '@playwright/test'

test.describe('Search Functionality', () =&gt; {
  test.beforeEach(async ({ page }) =&gt; {
    // Mocker l'API de recherche
    await page.route('/search.json*', async route =&gt; {
      const url = route.request().url()
      const query = new URL(url).searchParams.get('q')

      const mockResponse = {
        items: query ? [
          {
            title: `Résultat pour &quot;${query}&quot;`,
            url: '/blog/test-article',
            excerpt: `Ceci est un extrait contenant ${query}`
          }
        ] : [],
        total: query ? 1 : 0
      }

      await route.fulfill({
        status: 200,
        contentType: 'application/json',
        body: JSON.stringify(mockResponse)
      })
    })

    await page.goto('/')
  })

  test('should show search results', async ({ page }) =&gt; {
    const searchInput = page.locator('#search')
    const resultsContainer = page.locator('#search-results')

    await searchInput.fill('typescript')

    // Attendre que les résultats apparaissent
    await expect(resultsContainer).toBeVisible()
    await expect(page.locator('.search-result')).toHaveCount(1)
    await expect(page.getByText('Résultat pour &quot;typescript&quot;')).toBeVisible()
  })

  test('should handle empty search results', async ({ page }) =&gt; {
    await page.route('/search.json*', async route =&gt; {
      await route.fulfill({
        status: 200,
        contentType: 'application/json',
        body: JSON.stringify({ items: [], total: 0 })
      })
    })

    const searchInput = page.locator('#search')

    await searchInput.fill('nonexistent')

    await expect(page.getByText('Aucun résultat trouvé')).toBeVisible()
  })

  test('should close search results with Escape', async ({ page }) =&gt; {
    const searchInput = page.locator('#search')
    const resultsContainer = page.locator('#search-results')

    // Effectuer une recherche
    await searchInput.fill('typescript')
    await expect(resultsContainer).toBeVisible()

    // Appuyer sur Escape
    await page.keyboard.press('Escape')

    await expect(resultsContainer).not.toHaveClass(/visible/)
  })

  test('should handle search API errors', async ({ page }) =&gt; {
    await page.route('/search.json*', async route =&gt; {
      await route.fulfill({
        status: 500,
        contentType: 'application/json',
        body: JSON.stringify({ error: 'Internal Server Error' })
      })
    })

    // Spy sur les erreurs console
    const consoleErrors: string[] = []
    page.on('console', msg =&gt; {
      if (msg.type() === 'error') {
        consoleErrors.push(msg.text())
      }
    })

    const searchInput = page.locator('#search')

    await searchInput.fill('error')

    await expect(page.getByText('Erreur lors de la recherche')).toBeVisible()

    // Vérifier qu'une erreur a été loggée
    await page.waitForTimeout(100)
    expect(consoleErrors.some(error =&gt; error.includes('Search failed'))).toBe(true)
  })

  test('should debounce search requests', async ({ page }) =&gt; {
    let requestCount = 0

    await page.route('/search.json*', async route =&gt; {
      requestCount++
      await route.fulfill({
        status: 200,
        contentType: 'application/json',
        body: JSON.stringify({ items: [], total: 0 })
      })
    })

    const searchInput = page.locator('#search')

    // Taper rapidement plusieurs caractères
    await searchInput.pressSequentially('typescript', { delay: 50 })

    // Attendre que le debounce se termine
    await page.waitForTimeout(500)

    // Vérifier qu'une seule requête a été envoyée
    expect(requestCount).toBe(1)
  })
})

test.describe('Search Accessibility', () =&gt; {
  test('should be keyboard navigable', async ({ page }) =&gt; {
    await page.goto('/')

    // Naviguer au champ de recherche avec Tab
    await page.keyboard.press('Tab')
    await expect(page.locator('#search')).toBeFocused()

    // Effectuer une recherche
    await page.keyboard.type('typescript')

    // Vérifier que les résultats sont accessibles au clavier
    await page.keyboard.press('Tab')
    await expect(page.locator('.search-result a').first()).toBeFocused()
  })

  test('should have proper ARIA attributes', async ({ page }) =&gt; {
    await page.goto('/')

    const searchInput = page.locator('#search')
    const resultsContainer = page.locator('#search-results')

    // Vérifier les attributs ARIA
    await expect(searchInput).toHaveAttribute('role', 'searchbox')
    await expect(resultsContainer).toHaveAttribute('role', 'region')
    await expect(resultsContainer).toHaveAttribute('aria-live', 'polite')
  })
})</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="scripts_de_test_intégrés_2">14. Scripts de test intégrés</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Mettez à jour votre <code>package.json</code> :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span style="color:#606"><span style="color:#404">&quot;</span><span>scripts</span><span style="color:#404">&quot;</span></span>: {
    <span style="color:#606"><span style="color:#404">&quot;</span><span>dev:ts</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">vite</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>build:ts</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">vite build</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>dev</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">concurrently </span><span style="color:#b0b">\&quot;</span><span style="color:#D20">npm run dev:ts</span><span style="color:#b0b">\&quot;</span><span style="color:#D20"> </span><span style="color:#b0b">\&quot;</span><span style="color:#D20">./gradlew jbakeServe</span><span style="color:#b0b">\&quot;</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>build</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">npm run build:ts &amp;&amp; ./gradlew jbake</span><span style="color:#710">&quot;</span></span>,

    <span style="color:#606"><span style="color:#404">&quot;</span><span>test</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">vitest</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>test:ui</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">vitest --ui</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>test:coverage</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">vitest --coverage</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>test:watch</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">vitest --watch</span><span style="color:#710">&quot;</span></span>,

    <span style="color:#606"><span style="color:#404">&quot;</span><span>test:e2e</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">playwright test</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>test:e2e:ui</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">playwright test --ui</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>test:e2e:headed</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">playwright test --headed</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>test:e2e:debug</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">playwright test --debug</span><span style="color:#710">&quot;</span></span>,

    <span style="color:#606"><span style="color:#404">&quot;</span><span>test:all</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">npm run test:coverage &amp;&amp; npm run test:e2e</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>test:ci</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">npm run build &amp;&amp; npm run test:coverage &amp;&amp; npm run test:e2e</span><span style="color:#710">&quot;</span></span>
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="intégration_avec_le_build_gradle_2">15. Intégration avec le build Gradle</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Mettez à jour votre <code>build.gradle</code> :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">org.jbake.site</span><span style="color:#710">'</span></span> version <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">5.3.0</span><span style="color:#710">'</span></span>
    id <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">com.github.node-gradle.node</span><span style="color:#710">'</span></span> version <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">3.5.1</span><span style="color:#710">'</span></span>
}

<span style="color:#777">// Tasks de test</span>
task testUnit(<span style="color:#606">type</span>: NpmTask) {
    args = [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">run</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">test:coverage</span><span style="color:#710">'</span></span>]
    inputs.dir(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">src/ts</span><span style="color:#710">'</span></span>)
    outputs.dir(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">coverage</span><span style="color:#710">'</span></span>)
}

task testE2E(<span style="color:#606">type</span>: NpmTask) {
    args = [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">run</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">test:e2e</span><span style="color:#710">'</span></span>]
    inputs.dir(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">tests/e2e</span><span style="color:#710">'</span></span>)
    inputs.dir(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">build</span><span style="color:#710">'</span></span>) <span style="color:#777">// Dépend du site généré</span>
    outputs.dir(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">test-results</span><span style="color:#710">'</span></span>)
    dependsOn jbake
}

task testAll(<span style="color:#606">type</span>: NpmTask) {
    args = [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">run</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">test:all</span><span style="color:#710">'</span></span>]
    dependsOn buildTypeScript
}

<span style="color:#777">// Configuration des dépendances</span>
buildTypeScript.dependsOn npmInstall
testUnit.dependsOn buildTypeScript
jbake.dependsOn testUnit  <span style="color:#777">// Les tests doivent passer avant le build</span>

<span style="color:#777">// Task pour le pipeline CI/CD</span>
task ciPipeline {
    dependsOn testAll
    description = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Pipeline complet : build, tests unitaires et E2E</span><span style="color:#710">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="intégration_cicd_2">16. Intégration CI/CD</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="github_actions_2">16.1. GitHub Actions</h3>
<div class="paragraph">
<p>Créez <code>.github/workflows/test.yml</code> :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">Tests</span></span>

<span style="color:#606">on</span>:
  <span style="color:#606">push</span>:
    <span style="color:#606">branches</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">[ main, develop ]</span></span>
  <span style="color:#606">pull_request</span>:
    <span style="color:#606">branches</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">[ main ]</span></span>

<span style="color:#606">jobs</span>:
  <span style="color:#606">test</span>:
    <span style="color:#606">runs-on</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">ubuntu-latest</span></span>

    <span style="color:#606">strategy</span>:
      <span style="color:#606">matrix</span>:
        <span style="color:#606">node-version</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">[18, 20]</span></span>

    <span style="color:#606">steps</span>:
    - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">uses: actions/checkout@v4</span></span>

    - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">name: Setup Node.js ${{ matrix.node-version }}</span></span>
      <span style="color:#606">uses</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">actions/setup-node@v4</span></span>
      <span style="color:#606">with</span>:
        <span style="color:#606">node-version</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">${{ matrix.node-version }}</span></span>
        <span style="color:#606">cache</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">'npm'</span></span>

    - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">name: Setup Java</span></span>
      <span style="color:#606">uses</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">actions/setup-java@v4</span></span>
      <span style="color:#606">with</span>:
        <span style="color:#606">java-version</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">'17'</span></span>
        <span style="color:#606">distribution</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">'temurin'</span></span>

    - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">name: Install dependencies</span></span>
      <span style="color:#606">run</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">npm ci</span></span>

    - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">name: Run unit tests</span></span>
      <span style="color:#606">run</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">npm run test:coverage</span></span>

    - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">name: Build site</span></span>
      <span style="color:#606">run</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">./gradlew jbake</span></span>

    - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">name: Install Playwright browsers</span></span>
      <span style="color:#606">run</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">npx playwright install --with-deps</span></span>

    - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">name: Run E2E tests</span></span>
      <span style="color:#606">run</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">npm run test:e2e</span></span>

    - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">name: Upload coverage reports</span></span>
      <span style="color:#606">uses</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">codecov/codecov-action@v4</span></span>
      <span style="color:#606">with</span>:
        <span style="color:#606">file</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">./coverage/lcov.info</span></span>

    - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">name: Upload test results</span></span>
      <span style="color:#606">uses</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">actions/upload-artifact@v4</span></span>
      <span style="color:#606">if</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">always()</span></span>
      <span style="color:#606">with</span>:
        <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">playwright-report-${{ matrix.node-version }}</span></span>
        <span style="color:#606">path</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">playwright-report/</span></span>
        <span style="color:#606">retention-days</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">30</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="bonnes_pratiques_de_test_2">17. Bonnes pratiques de test</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="tests_unitaires_2">17.1. Tests unitaires</h3>
<div class="ulist">
<ul>
<li>
<p><strong>Testez la logique métier</strong> - Pas les détails d&#8217;implémentation</p>
</li>
<li>
<p><strong>Un test = un comportement</strong> - Tests focalisés et lisibles</p>
</li>
<li>
<p><strong>Arrange, Act, Assert</strong> - Structure claire des tests</p>
</li>
<li>
<p><strong>Mockez les dépendances externes</strong> - Tests isolés et rapides</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="tests_dintégration_2">17.2. Tests d&#8217;intégration</h3>
<div class="ulist">
<ul>
<li>
<p><strong>Testez les interactions</strong> - Entre composants et avec le DOM</p>
</li>
<li>
<p><strong>Simulez les conditions réelles</strong> - Événements utilisateur authentiques</p>
</li>
<li>
<p><strong>Vérifiez les effets de bord</strong> - État global, stockage local, etc.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="tests_e2e_2">17.3. Tests E2E</h3>
<div class="ulist">
<ul>
<li>
<p><strong>Testez les parcours critiques</strong> - Workflows métier importants</p>
</li>
<li>
<p><strong>Tests stables</strong> - Utilisez des sélecteurs robustes</p>
</li>
<li>
<p><strong>Données de test isolées</strong> - Évitez les dépendances entre tests</p>
</li>
<li>
<p><strong>Performance</strong> - Limitez le nombre de tests E2E</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="organisation_des_tests_2">17.4. Organisation des tests</h3>
<div class="paragraph">
<p>Pour maintenir une suite de tests claire et gérable, suivez ces principes :</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Colocation</strong> : Placez les tests unitaires (<code>.test.ts</code> ou <code>.spec.ts</code>) à côté du code qu&#8217;ils testent, idéalement dans un sous-répertoire <code><em>tests</em></code>.
Cela facilite la navigation et garantit que les tests sont supprimés ou déplacés avec le code correspondant.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript">    src/
    └── ts/
        ├── components/
        │   ├── MyComponent.ts
        │   └── __tests__/
        │       └── MyComponent.test.ts // Test unitaire du composant
        └── utils/
            ├── DateUtils.ts
            └── __tests__/
                └── DateUtils.test.ts // Test unitaire de l'utilitaire</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Dossiers dédiés pour E2E et intégration</strong> : Créez des dossiers de haut niveau pour les tests E2E (<code>tests/e2e</code>) et les tests d&#8217;intégration (si distincts de l&#8217;unité, par exemple <code>tests/integration</code>).
Cela sépare clairement les types de tests et leurs configurations.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript">    tests/
    ├── e2e/                     // Playwright tests
    │   ├── navigation.spec.ts
    │   └── user-flow.spec.ts
    └── integration/             // Vitest (jsdom) pour des scénarios plus complexes
        ├── form-submission.test.ts
        └── data-fetching.test.ts</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Nommage cohérent</strong> : Utilisez des conventions de nommage claires comme <code><strong>.test.ts</code> pour Vitest et <code></strong>.spec.ts</code> pour Playwright (bien que les deux puissent utiliser l&#8217;un ou l&#8217;autre).
Assurez-vous que le nom du fichier de test reflète clairement ce qu&#8217;il teste.</p>
</li>
<li>
<p><strong>Fichiers de fixtures/mocks</strong> : Centralisez les données de test, les mocks et les helpers réutilisables dans des dossiers <code>fixtures</code> ou <code>mocks</code> dédiés au sein de vos répertoires de tests.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript">tests/
└── e2e/
    └── fixtures/
    ├── test-data.json
    └── auth-helper.ts</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="conclusion">18. Conclusion</h2>
<div class="sectionbody">
<div class="paragraph">
<p>L&#8217;intégration de tests unitaires avec <strong>Vitest</strong> et de tests E2E avec <strong>Playwright</strong> transforme le développement de votre site JBake en une expérience beaucoup plus robuste et fiable.
En adoptant ces pratiques et en les automatisant via <strong>Gradle</strong> et <strong>GitHub Actions</strong>, vous assurez que chaque modification de code est vérifiée et que votre site statique reste fonctionnel et performant.</p>
</div>
<div class="paragraph">
<p>Les tests ne sont pas un frein, mais un investissement qui vous fera gagner du temps et de la tranquillité d&#8217;esprit à long terme.</p>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2025-05-29 00:53:03 +0200
</div>
</div>
<script>
;(function () { /*! Asciidoctor Tabs | Copyright (c) 2018-present Dan Allen | MIT License */
  'use strict'

  var config = (document.currentScript || {}).dataset || {}
  var forEach = Array.prototype.forEach

  init(document.querySelectorAll('.tabs'))

  function init (tabsBlocks) {
    if (!tabsBlocks.length) return
    forEach.call(tabsBlocks, function (tabs) {
      var syncIds = tabs.classList.contains('is-sync') ? {} : undefined
      var tablist = tabs.querySelector('.tablist ul')
      tablist.setAttribute('role', 'tablist')
      var start
      forEach.call(tablist.querySelectorAll('li'), function (tab, idx) {
        tab.tabIndex = -1
        tab.setAttribute('role', tab.classList.add('tab') || 'tab')
        var id, anchor, syncId
        if (!(id = tab.id) && (anchor = tab.querySelector('a[id]'))) {
          id = tab.id = anchor.parentNode.removeChild(anchor).id
        }
        var panel = id && tabs.querySelector('.tabpanel[aria-labelledby~="' + id + '"]')
        if (!panel) return idx ? undefined : toggleSelected(tab, true) // invalid state
        syncIds && (((syncId = tab.textContent.trim()) in syncIds) ? (syncId = undefined) : true) &&
        (syncIds[(tab.dataset.syncId = syncId)] = tab)
        idx || (syncIds && (start = { tab: tab, panel: panel })) ? toggleHidden(panel, true) : toggleSelected(tab, true)
        tab.setAttribute('aria-controls', panel.id)
        panel.setAttribute('role', 'tabpanel')
        var onClick = syncId === undefined ? activateTab : activateTabSync
        tab.addEventListener('click', onClick.bind({ tabs: tabs, tab: tab, panel: panel }))
      })
      if (!tabs.closest('.tabpanel')) {
        forEach.call(tabs.querySelectorAll('.tabpanel table.tableblock'), function (table) {
          var container = Object.assign(document.createElement('div'), { className: 'tablecontainer' })
          table.parentNode.insertBefore(container, table).appendChild(table)
        })
      }
      if (start) {
        var syncGroupId
        for (var i = 0, lst = tabs.classList, len = lst.length, className; i !== len; i++) {
          if (!(className = lst.item(i)).startsWith('data-sync-group-id=')) continue
          tabs.dataset.syncGroupId = syncGroupId = lst.remove(className) || className.slice(19).replace(/\u00a0/g, ' ')
          break
        }
        if (syncGroupId === undefined) tabs.dataset.syncGroupId = syncGroupId = Object.keys(syncIds).sort().join('|')
        var preferredSyncId = 'syncStorageKey' in config &&
          window[(config.syncStorageScope || 'local') + 'Storage'].getItem(config.syncStorageKey + '-' + syncGroupId)
        var tab = preferredSyncId && syncIds[preferredSyncId]
        tab && Object.assign(start, { tab: tab, panel: document.getElementById(tab.getAttribute('aria-controls')) })
        toggleSelected(start.tab, true) || toggleHidden(start.panel, false)
      }
    })
    onHashChange()
    toggleClassOnEach(tabsBlocks, 'is-loading', 'remove')
    window.setTimeout(toggleClassOnEach.bind(null, tabsBlocks, 'is-loaded', 'add'), 0)
    window.addEventListener('hashchange', onHashChange)
  }

  function activateTab (e) {
    var tab = this.tab
    var tabs = this.tabs || (this.tabs = tab.closest('.tabs'))
    var panel = this.panel || (this.panel = document.getElementById(tab.getAttribute('aria-controls')))
    querySelectorWithSiblings(tabs, '.tablist .tab', 'tab').forEach(function (el) {
      toggleSelected(el, el === tab)
    })
    querySelectorWithSiblings(tabs, '.tabpanel', 'tabpanel').forEach(function (el) {
      toggleHidden(el, el !== panel)
    })
    if (!this.isSync && 'syncStorageKey' in config && 'syncGroupId' in tabs.dataset) {
      var storageKey = config.syncStorageKey + '-' + tabs.dataset.syncGroupId
      window[(config.syncStorageScope || 'local') + 'Storage'].setItem(storageKey, tab.dataset.syncId)
    }
    if (!e) return
    var loc = window.location
    var hashIdx = loc.hash ? loc.href.indexOf('#') : -1
    if (~hashIdx) window.history.replaceState(null, '', loc.href.slice(0, hashIdx))
    e.preventDefault()
  }

  function activateTabSync (e) {
    activateTab.call(this, e)
    var thisTabs = this.tabs
    var thisTab = this.tab
    var initialY = thisTabs.getBoundingClientRect().y
    forEach.call(document.querySelectorAll('.tabs'), function (tabs) {
      if (tabs === thisTabs || tabs.dataset.syncGroupId !== thisTabs.dataset.syncGroupId) return
      querySelectorWithSiblings(tabs, '.tablist .tab', 'tab').forEach(function (tab) {
        if (tab.dataset.syncId === thisTab.dataset.syncId) activateTab.call({ tabs: tabs, tab: tab, isSync: true })
      })
    })
    var shiftedBy = thisTabs.getBoundingClientRect().y - initialY
    if (shiftedBy && (shiftedBy = Math.round(shiftedBy))) window.scrollBy({ top: shiftedBy, behavior: 'instant' })
  }

  function querySelectorWithSiblings (scope, selector, siblingClass) {
    var el = scope.querySelector(selector)
    if (!el) return []
    var result = [el]
    while ((el = el.nextElementSibling) && el.classList.contains(siblingClass)) result.push(el)
    return result
  }

  function toggleClassOnEach (elements, className, method) {
    forEach.call(elements, function (el) {
      el.classList[method](className)
    })
  }

  function toggleHidden (el, state) {
    el.classList[(el.hidden = state) ? 'add' : 'remove']('is-hidden')
  }

  function toggleSelected (el, state) {
    el.setAttribute('aria-selected', '' + state)
    el.classList[state ? 'add' : 'remove']('is-selected')
    el.tabIndex = state ? 0 : -1
  }

  function onHashChange () {
    var id = window.location.hash.slice(1)
    if (!id) return
    var tab = document.getElementById(~id.indexOf('%') ? decodeURIComponent(id) : id)
    if (!(tab && tab.classList.contains('tab'))) return
    'syncId' in tab.dataset ? activateTabSync.call({ tab: tab }) : activateTab.call({ tab: tab })
  }
})()
</script>
</body>
</html>